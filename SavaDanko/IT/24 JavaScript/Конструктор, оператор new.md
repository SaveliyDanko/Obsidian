#js 

---
[Constructor-New](https://learn.javascript.ru/constructor-new)

---
#### Функция-конструктор
Функция-конструктор — это обычная функция, которая используется для создания новых объектов. Её имя должно начинаться с заглавной буквы.
  
Пример функции-конструктора:
```javascript
function User(name) {
	this.name = name;
    this.isAdmin = false;
}

let user = new User("Jack");
alert(user.name);  // Jack
alert(user.isAdmin);  // false
```

#### Оператор new
Когда функция вызывается через `new`, происходят следующие шаги:
- Создаётся новый пустой объект, и `this` присваивается этому объекту.
- Функция выполняется, и в `this` добавляются свойства.
- Возвращается объект `this`.
  
Пример эквивалентного результата:
  ```javascript
  let user = {
    name: "Jack",
    isAdmin: false
  };
  ```

#### new function()
Можно использовать `new function()` для создания сложного объекта сразу в одном месте:
```javascript
let user = new function() {
	this.name = "John";
    this.isAdmin = false;
    // Дополнительный код и логика
};
  ```

#### Свойство `new.target`
В JavaScript есть специальное свойство `new.target`, которое позволяет определить, была ли функция вызвана с оператором `new` (в режиме конструктора) или без него (в обычном режиме).
  
Пример:
```javascript
function User() {
	alert(new.target);
}

User();  // undefined (вызов без new)
new User();  // function User {...} (вызов с new)
  ```

#### Использование `new.target` для гибкости
С помощью `new.target` можно сделать так, чтобы вызовы функции с `new` и без него делали одно и то же. Например, перенаправлять обычный вызов на конструктор:
```javascript
function User(name) {
	if (!new.target) {
		return new User(name);  // автоматически добавляем new, если вызов без него
    }
	this.name = name;
}

  let john = User("John");  // Работает так же, как new User("John")
  alert(john.name);  // John
```

#### Когда использовать
Этот подход может быть полезен в библиотеках для более гибкого синтаксиса, но не рекомендуется для повседневного использования, так как он может привести к путанице. Лучше явно использовать `new`, чтобы было ясно, что создаётся новый объект.

#### Обычное поведение конструктора
Конструкторы в JavaScript обычно не имеют оператора `return`, их задача — записать всё необходимое в `this`, и это автоматически становится результатом.

Однако если в конструкторе есть `return`, применяются следующие правила:
- Если возвращается объект, то возвращается этот объект вместо `this`.
- Если возвращается примитив, то он игнорируется, и всё равно возвращается `this`.

#### Пример возврата объекта
Если внутри конструктора используется возврат объекта:
```javascript
function BigUser() {
	this.name = "John";
    return { name: "Godzilla" };  // возврат объекта
}

alert(new BigUser().name);  // Godzilla
```

#### Пример с пустым `return`
Если `return` отсутствует или возвращается примитив:
```javascript
function SmallUser() {
	this.name = "John";
    return;  // игнорируется
}

alert(new SmallUser().name);  // John
```

#### Создание методов в конструкторе
Конструктор может создавать не только свойства, но и методы объекта.
```javascript
function User(name) {
	this.name = name;
    this.sayHi = function() {
		alert("Меня зовут " + this.name);
	};
}

let john = new User("John");
john.sayHi();  // Меня зовут John
```

#### Пропуск скобок при вызове `new`
Круглые скобки можно опускать, если конструктор вызывается без аргументов, но это считается плохой практикой:
  ```javascript
  let user = new User;  // то же, что и new User()
  ```
