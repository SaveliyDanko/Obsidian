–ò–Ω–¥–µ–∫—Å—ã –≤ PostgreSQL ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, —É–º–µ–Ω—å—à–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º—ã—Ö —Å—Ç—Ä–æ–∫.

###### **–ß—Ç–æ —Ç–∞–∫–æ–µ INDEX**
–ò–Ω–¥–µ–∫—Å ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ —Å –∏—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ.
> –ö–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å `SELECT ... WHERE column = value`, PostgreSQL –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã (full table scan).


###### **–ö–∞–∫ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–Ω–¥–µ–∫—Å**
```sql
CREATE INDEX –∏–º—è_–∏–Ω–¥–µ–∫—Å–∞
ON –∏–º—è_—Ç–∞–±–ª–∏—Ü—ã (—Å—Ç–æ–ª–±–µ—Ü1 [, —Å—Ç–æ–ª–±–µ—Ü2, ...]);
```

–ü—Ä–∏–º–µ—Ä:
```sql
CREATE INDEX idx_users_email ON users (email);
```

###### **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç PostgreSQL –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å–∞**
1. –°–º–æ—Ç—Ä–∏—Ç –≤ `pg_statistic` –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `WHERE`, `JOIN`, `ORDER BY`.
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã.
3. –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å —É—Å–∫–æ—Ä–∏—Ç –∑–∞–ø—Ä–æ—Å ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –≤ –ø–ª–∞–Ω–µ (`EXPLAIN`).
4. –ò–∑ –∏–Ω–¥–µ–∫—Å–∞ —É–∑–Ω–∞—ë—Ç, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (TID ‚Äî tuple ID).
5. –ß–∏—Ç–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –Ω–∞–ø—Ä—è–º—É—é.
    

###### –¢–∏–ø—ã –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ PostgreSQL

| –¢–∏–ø         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                         |
| ----------- | ---------------------------------------------------------------------------------- |
| **B-tree**  | üîπ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ò–¥–µ–∞–ª–µ–Ω –¥–ª—è `=`, `<`, `<=`, `>`, `>=`, `BETWEEN`, `ORDER BY`      |
| **Hash**    | üî∏ –¢–æ–ª—å–∫–æ –¥–ª—è `=`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ (–≤ —Ç.—á. –≤ hash joins)                        |
| **GIN**     | üîç –î–ª—è –º–∞—Å—Å–∏–≤–æ–≤, `tsvector`, `jsonb` ‚Äî –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫, `@>`, `?`, `IN`       |
| **GiST**    | üìç –ì–µ–æ-–ø–æ–∏—Å–∫, –¥–∏–∞–ø–∞–∑–æ–Ω—ã, –±–ª–∏–∑–æ—Å—Ç—å ‚Äî `PostGIS`, `int4range`, `point`, `box`         |
| **BRIN**    | üíΩ –ë–æ–ª—å—à–∏–µ, —Å–ª–∞–±–æ –∏–∑–º–µ–Ω—è—é—â–∏–µ—Å—è —Ç–∞–±–ª–∏—Ü—ã —Å —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (`time-series`) |
| **SP-GiST** | üìê –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `quadtrees`)              |

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏–Ω–¥–µ–∫—Å–æ–≤

---

### 1. **–ò–Ω–¥–µ–∫—Å –Ω–∞ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü**

```sql
CREATE INDEX idx_users_name ON users (name);
```

### 2. **–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å (–º–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–æ–≤)**

```sql
CREATE INDEX idx_orders_customer_date ON orders (customer_id, order_date);
```

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ —Ç—ã —á–∞—Å—Ç–æ –¥–µ–ª–∞–µ—à—å `WHERE customer_id = ? AND order_date > ?`

### 3. **–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å**

```sql
CREATE UNIQUE INDEX idx_users_email ON users (email);
```

> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ `UNIQUE` –∏ `PRIMARY KEY`.

### 4. **–ò–Ω–¥–µ–∫—Å –ø–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—é**

```sql
CREATE INDEX idx_users_lower_email ON users (LOWER(email));
```

> –†–∞–±–æ—Ç–∞–µ—Ç —Å `WHERE LOWER(email) = 'x@y.com'`

---

## ‚öôÔ∏è –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º

PostgreSQL **—Ö—Ä–∞–Ω–∏—Ç –∏–Ω–¥–µ–∫—Å—ã –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Ç–∞–±–ª–∏—Ü**, –Ω–æ **–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏—Ö –ª–µ–Ω–∏–≤–æ** ‚Äî –æ–Ω–∏ **–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ** –ø—Ä–∏ `INSERT`, `UPDATE`, `DELETE`.

> –ò–Ω–¥–µ–∫—Å—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è, –Ω–æ **–∑–∞–º–µ–¥–ª—è—é—Ç –∑–∞–ø–∏—Å—å**.

---

## üìà –ö–∞–∫ —É–∑–Ω–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∏–Ω–¥–µ–∫—Å?

```sql
EXPLAIN ANALYZE
SELECT * FROM users WHERE email = 'test@example.com';
```

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å `Index Scan` –∏–ª–∏ `Bitmap Index Scan` ‚Äî –∏–Ω–¥–µ–∫—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

---

## üõ† –£–¥–∞–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ

```sql
DROP INDEX idx_users_email;
REINDEX INDEX idx_users_email;
```

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ –æ—à–∏–±–∫–∞—Ö.

---

## üîÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

PostgreSQL **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—ã–π –∏–Ω–¥–µ–∫—Å** –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ. –¢–µ–±–µ –Ω–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, **–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏ –∞–Ω–∞–ª–∏–∑ EXPLAIN ‚Äî –∫—Ä–∏—Ç–∏—á–µ–Ω**.

---

## üß† Best practices

|–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è|–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ|
|---|---|
|–ù–µ —Å–æ–∑–¥–∞–≤–∞–π –∏–Ω–¥–µ–∫—Å—ã ¬´–Ω–∞ –≤—Å—ë –ø–æ–¥—Ä—è–¥¬ª|–û–Ω–∏ –∑–∞–º–µ–¥–ª—è—é—Ç –∑–∞–ø–∏—Å—å –∏ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ—Å—Ç–æ|
|–ò—Å–ø–æ–ª—å–∑—É–π `EXPLAIN ANALYZE`|–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∏–Ω–¥–µ–∫—Å|
|–ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `WHERE`, `JOIN`, `ORDER BY`|–û—Å–Ω–æ–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è|
|–í—ã—Ä–∞–∂–µ–Ω–∏—è –∏ —á–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã|–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –ø—Ä–∏ —É—Å–ª–æ–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ö (`status = 'active'`)|
|`CLUSTER`, `VACUUM`, `REINDEX`|–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è|

---

## ‚úÖ –í—ã–≤–æ–¥

|–≠–ª–µ–º–µ–Ω—Ç|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|
|`CREATE INDEX`|–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞|
|`B-tree`|–û—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø: —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω—ã|
|`GIN`, `GiST`|–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä: –º–∞—Å—Å–∏–≤–æ–≤, JSON, fulltext|
|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ|`WHERE`, `JOIN`, `ORDER BY`, `DISTINCT`, `GROUP BY`|
|–ê–Ω–∞–ª–∏–∑|`EXPLAIN`, `pg_stat_user_indexes`, `pg_indexes`|

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É:

- –ø–æ–∫–∞–∑–∞—Ç—å `EXPLAIN ANALYZE` —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏;
    
- –æ–±—ä—è—Å–Ω–∏—Ç—å `partial indexes`, `covering indexes`, `multicolumn index` —Ç–æ–Ω–∫–æ;
    
- —Å—Ä–∞–≤–Ω–∏—Ç—å `B-tree` vs `BRIN` vs `GIN` –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ.