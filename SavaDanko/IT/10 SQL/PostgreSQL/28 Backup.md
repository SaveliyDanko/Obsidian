В PostgreSQL резервное копирование (backup) — это фундаментальная часть обеспечения отказоустойчивости и безопасности данных. Существует несколько способов делать бэкапы, и выбор зависит от требований к:
- точности (point-in-time recovery)
- размеру базы
- частоте изменений
- времени на восстановление (RTO)
- возможности репликации
    
###### **Основные типы резервного копирования в PostgreSQL**

| Тип                       | Назначение                                   | Инструмент                       |
| ------------------------- | -------------------------------------------- | -------------------------------- |
| Логический бэкап          | Копирует структуру и данные (SQL)            | `pg_dump`, `pg_dumpall`          |
| Физический бэкап          | Побайтовая копия всех файлов базы данных     | `pg_basebackup`, rsync           |
| Архивация WAL             | Для point-in-time recovery (PITR)            | `archive_mode + archive_command` |
| Снапшоты файловой системы | Быстрое копирование с использованием LVM/ZFS | `LVM`, `ZFS`, облачные решения   |

###### **Логическое копирование (`pg_dump`)**
Простой и удобный для миграций и восстановления отдельных объектов.
```bash
pg_dump -U postgres -d mydb -F c -f mydb.backup
```

| Параметр | Описание                         |
| -------- | -------------------------------- |
| `-U`     | Пользователь PostgreSQL          |
| `-d`     | База данных                      |
| `-F c`   | Формат custom (для `pg_restore`) |
| `-f`     | Куда сохранить файл              |

Можно восстановить с помощью:
```bash
pg_restore -U postgres -d newdb mydb.backup
```
Можно бэкапить отдельные таблицы (`-t`), схемы (`-n`), или только структуру (`-s`).

---
###### **Полная логическая копия всех БД (`pg_dumpall`)**
```bash
pg_dumpall -U postgres > full_dump.sql
```
Удобно, если нужно скопировать **всю кластерную структуру**, включая роли, базы и настройки.

###### Физическое копирование (`pg_basebackup`)
Побайтовое копирование всех файлов кластера.
```bash
pg_basebackup -U repl_user -D /backups/mydb -Fp -Xs -P
```

| Опция | Описание                     |
| ----- | ---------------------------- |
| `-D`  | Путь для сохранения          |
| `-Fp` | Plain формат (обычные файлы) |
| `-Xs` | Включает WAL-файлы           |
| `-P`  | Показывает прогресс          |
Обычно используется с репликацией и PITR.

###### Архиавция WAL (PITR)
WAL — Write-Ahead Log — журнал всех изменений в базе. Архивация WAL позволяет делать восстановление на конкретный момент времени (PITR).