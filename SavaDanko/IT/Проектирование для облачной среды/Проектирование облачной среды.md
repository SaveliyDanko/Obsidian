
**Снежинки**

---
- Микросервисы и другие модные подходы не решат все проблемы сами по себе.
- «Переход в облако» как перенос приложений в чужой ЦОД не делает систему cloud-native.
- Такой перенос без пересмотра архитектуры может снизить эффективность и не повысит устойчивость.
- Cloud-native — это про методы разработки и архитектурные подходы, оптимизированные под облачную среду.
- Локальная инфраструктура тоже может поддерживать cloud-native-решения, если спроектирована соответствующе.
- Подход cloud-native полезен не для всех сценариев и не всегда универсален.

---
- Не всё ПО должно быть облачным — новые подходы могут быть избыточны или создавать проблемы.
- Некоторые системы не требуют облака из-за своей стабильности, простоты или тесной связи с физическими устройствами.
- Если необходима строгая согласованность данных, многие облачные шаблоны неприменимы.
- Старое ПО и инфраструктура могут оставаться эффективными десятилетиями, и их переписывание не всегда целесообразно.
- Переход на cloud-native должен быть обоснован бизнес-выгодой и приоритетами, а не следованием моде.

---
- Полностью cloud-native архитектура редко возможна — новые компоненты должны взаимодействовать с существующими системами.
- Применение облачных шаблонов даже частично приносит пользу и повышает устойчивость системы.
- Миграцию можно проводить поэтапно: частичный переход в облако уже даёт ценность.
- Архитектура, ориентированная на микросервисы и облачную среду, становится доминирующей.
- Облачная среда — это новый вычислительный субстрат с программно-определяемыми ресурсами, распределённостью и динамичностью.

---
- Развёртывание и эксплуатация — системная боль, а не «чужая» задача разработчиков.
- Текущие процессы снижения риска часто тормозят поставку и ухудшают поддерживаемость.
- Проблемы лежат в организации и операционных практиках, а не только в коде.
- Решение — проектировать систему, где разработка тесно связана с операциями и развёртыванием.
- Начинать нужно с анализа препятствий текущей системы и их устранения.
- Использование облачных шаблонов и практик должно упрощать весь цикл поставки и эксплуатации.

---
- Производственные операции сложны, вызывают конфликты между командами и требуют ночной работы.
- Проблема не в людях, а в системе, создающей барьеры на пути к успешному развёртыванию.
- Основные препятствия: изменчивость артефактов и сред («снежинки»), высокий риск изменений и редкость развёртываний.
- Ожидание стабильности инфраструктуры ошибочно в современных распределённых системах.
- Нестабильность окружения усиливает все проблемы и ограничивает частоту развёртываний.

---
- «Снежинки» — это различия сред и артефактов, возникающие на этапах SDLC и мешающие развёртыванию.
- Несогласованность зависимостей и конфигураций между средами приводит к сбоям и задержкам.
- Изменение артефактов при каждой сборке увеличивает риск непреднамеренных отличий.
- Различия окружений вызывают непредсказуемое поведение и операционную нестабильность.
- Даже мелкие изменения инфраструктуры требуют пересборки артефактов, создавая новые расхождения.
- Индивидуальные среды и уникальные пакеты усиливают риск и неопределённость развёртываний.

---
- Развёртывания часто выполняются ночью из-за высокого риска простоев и потери дохода.
- Компании создают сложные процессы и тестовые среды, чтобы снизить риск, но это усложняет и замедляет релизы.
- Поддержание точной копии рабочей среды дорого и трудоёмко, особенно с учётом множества команд и приложений.
- Координация версий и тестирования быстро становится неуправляемой даже в простых сценариях.
- Даже тщательно подготовленные тесты не гарантируют предсказуемости в продакшене, и развёртывание остаётся рискованным.
- Из-за высокого риска компании вводят периоды запрета на развёртывания в критические сезоны.
- Ошибки и уязвимости могут оставаться неустранёнными, пока не появится возможность релиза.
- Редкие релизы увеличивают объём изменений и взаимосвязей, повышая вероятность сбоев.
- Рискованные развёртывания напрямую подрывают стабильность системы.

---
- В ИТ до сих пор доминирует устаревшее мышление: изменения считаются исключением.
- Ответственность за систему после релиза передаётся эксплуатации, что отрывает разработчиков от реальности.
- Предположение о предсказуемости сбоев и стабильности после развёртывания часто ошибочно.
- Такой подход оставляет команды неготовыми к неожиданным проблемам.
- В облачной среде изменения постоянны, и системы должны быть спроектированы с учётом этой динамики.

---
- Нестабильное рабочее окружение делает развёртывания ещё более рискованными и проблемными.
- Стабильность среды — необходимое условие для безопасного выпуска нового ПО.
- Постоянная «пожаротушение» сокращает доступные окна для развёртываний и усиливает замкнутый круг проблем.
- Разработка — лишь начало пути; главная сложность — надёжная эксплуатация.
- Применение принципов cloud-native помогает оптимизировать весь цикл поставки и повысить устойчивость системы.

---
- Компании нового поколения разработали противоположный подход: частые и простые релизы при высокой стабильности.
- Повторяемость вместо «снежинок» повышает предсказуемость и снижает нестабильность.
- Безопасные развёртывания делают систему гибче и устойчивее.
- Ожидание постоянных изменений вместо фиксированной среды сокращает число инцидентов.
- Ключевым драйвером новой модели стала непрерывная доставка, радикально упрощающая развёртывания и улучшая весь жизненный цикл ПО.

---
- Непрерывная доставка означает готовность кода к развертыванию в любой момент, а не постоянные релизы.
- Автоматизация тестирования и упаковки встроена прямо в цикл разработки.
- Частые готовые сборки дают бизнесу гибкость и контроль над временем релиза.
- Такой подход позволяет быстро реагировать на рыночные изменения и опережать конкурентов.
- Традиционные длинные циклы делают выпуск медленным и превращают ИТ в ограничивающий фактор.
- Частые релизы позволяют собирать обратную связь и корректировать направление развития продукта.
- Гибкость в планах важнее их жёсткого соблюдения — фиксация на первоначальных планах мешает адаптации.
- Оценка сроков разработки часто ошибочна из-за оптимизма и непредвиденных проблем.
- Длинные циклы вынуждают выбирать между качеством и сроками, оба варианта нежелательны.
- Короткие циклы дают больше опций: выпуск с меньшим функционалом или минимальную задержку.
- Частые и безопасные релизы уменьшают риск и усиливают контроль бизнеса над выходом продукта на рынок.
- Непрерывная доставка — основа современной системы разработки и ключ к изменениям в архитектуре ПО.

---
- Повторяемость устраняет хаос «снежинок» и делает развёртывания предсказуемыми и стабильными.
- Она ускоряет итерации и снижает риски как при релизе, так и при эксплуатации.
- Предсказуемость конфигурации упрощает восстановление после сбоев и масштабирование.
- Достигается это дисциплиной: контролем среды, артефактов и самих процессов развёртывания.

---
- Контроль среды достигается через стандартизированные образы машин и инфраструктуру как код.
- Все изменения среды должны быть автоматизированы и зафиксированы в коде, а не выполняться вручную.
- Ручные изменения (например, через SSH) подрывают предсказуемость и должны быть запрещены или строго контролироваться.
- Любые изменения должны вноситься через обновление базового образа и систему управления версиями.
- Ранняя дисциплина в управлении средой напрямую влияет на эффективность развёртывания и эксплуатации.

---
- Различия между средами неизбежны, но их нельзя вшивать в код или артефакт.
- Компиляция специфичных параметров в артефакт нарушает повторяемость и делает сборки разными.
- Один и тот же артефакт должен использоваться во всех средах — от разработки до продакшена.
- Конфигурации должны быть отделены от кода и подставляться динамически из внешних источников.
- Абстрагирование изменчивости среды обеспечивает гибкость, надёжность и предсказуемость развёртываний.

---
- После стандартизации среды и артефакта необходимо обеспечить контролируемый и воспроизводимый процесс развёртывания.
- Все этапы должны использовать один и тот же артефакт и согласованную среду, различаясь только конфигурацией.
- Ключ к последовательности и устранению «снежинок» — полная автоматизация всего жизненного цикла, от сборки до продакшена.
- Автоматизация должна охватывать не только сборку, но и развёртывание в тестовых и рабочих средах.
- Полностью автоматизированные конвейеры исключают ручные действия и повышают безопасность и надёжность процесса.

---
- Традиционный подход делает развёртывания медленными и рискованными из-за чрезмерного тестирования.
- **Cloud-native компании безопасно экспериментируют прямо в продакшене, используя «страховочные сетки».**
- Цель — не устранить сбои полностью, а сделать их некатастрофическими и управляемыми.
- Такой подход сокращает цикл релизов, повышает их частоту и упрощает выпуск.
- Безопасное развёртывание улучшает стабильность системы и позволяет быстрее реагировать на ошибки.
- Основу «страховочной сетки» составляют параллельные версии сервисов, телеметрия и гибкая маршрутизация.
- Безопасное развёртывание основано на параллельном запуске старой и новой версий с постепенным переключением трафика.
- Критически важны версии артефактов и связанная с ними телеметрия для корректного анализа стабильности и результатов.
- Метрики должны охватывать как общесистемные, так и доменные показатели и быть легко доступными.
- Гибкая маршрутизация позволяет точно контролировать трафик по критериям и минимизировать риски.
- Мелкие, изолированные единицы развёртывания (микросервисы) снижают влияние ошибок и повышают устойчивость системы.

---
- Традиционная модель исходит из того, что изменения редки и завершение работы возможно — это ложная установка.
- Необходимо принять постоянные изменения как норму и строить системы, которые к ним адаптируются.
- Ключ — концепция желаемого и фактического состояния и их непрерывное выравнивание.
- Система должна постоянно сравнивать состояния и автоматически устранять отклонения.
- Подход «согласованности в конечном счёте» повышает устойчивость, надёжность и длительность безотказной работы.
- Развёртывание становится выражением нового желаемого состояния, упрощая процесс и снижая риск.

---
# Глава 3 Платформа для облачного ПО
- Глава посвящена ключевым элементам облачной платформы и их роли в жизненном цикле ПО.
- Рассматривается история эволюции облачных платформ и основы контейнеризации.
- Показывается, как платформа повышает стабильность и управляемость приложений.
- Автоматическое восстановление и управление снижает влияние сбоев на пользователей и операторов.
- Понимание возможностей платформы позволяет сосредоточиться на бизнес-задачах и оптимизировать приложения под облако.

---
## 3.1. Эволюция облачных платформ
- Платформы для разработки и эксплуатации ПО существуют давно (например, J2EE, JBoss, WebSphere).
- Они сыграли ключевую роль в развитии индустрии и принесли значительные коммерческие успехи.
- Современные требования к ПО требуют новых архитектур и, соответственно, новых платформ.
- Эволюция платформ — это ответ на изменения в способах разработки и эксплуатации систем.

---
### 3.1.1. Все началось с облака
- Старт развития облачных платформ связан с AWS (EC2, S3, SQS), позволивших получать ресурсы без собственного оборудования.
- Первоначально облако означало лишь новое место выполнения вычислений без изменения архитектур.
- Использование недорогого оборудования в облаках потребовало компенсировать сбои на уровне ПО и ввело новые абстракции (зоны доступности, регионы).
- Эти абстракции изменили подход к разработке и стали влиять на архитектуру приложений.
- Google (App Engine) и Microsoft предложили более высокоуровневые платформы, скрывающие инфраструктуру и берущие на себя её управление.
- Разные подходы провайдеров к уровню абстракций привели к появлению нового класса — платформ для облачной среды.

---
### 3.1.2. Тональный вызов
- Раньше операторы работали с инфраструктурными примитивами (хостами, сетями, каталогами) для управления и диагностики приложений.
- Облачные платформы меняют подход: оператор взаимодействует напрямую с приложением и его сущностями (журналами, политиками и т.д.).
- Платформа абстрагирует инфраструктуру, агрегирует данные и берёт на себя задачи по распределению ресурсов и защите.
- Это сдвиг от инфраструктурной модели к ориентированной на приложение, что упрощает эксплуатацию и повышает эффективность.
- Такие платформы (Cloud Foundry, Google App Engine, AWS Elastic Beanstalk, Azure App Service) предоставляют «тональный вызов приложения» — новый уровень абстракции и взаимодействия.

---
## 3.2. Основные принципы платформы для облачной среды
### 3.2.1. Вначале поговорим о контейнерах
- Контейнеры стали ключевым фактором развития облачного ПО и платформ.
- Это лёгкие изолированные вычислительные среды, совместно использующие ядро ОС хоста и запускающие собственную среду выполнения и приложение.
- Они создаются и запускаются быстрее и требуют меньше ресурсов, чем виртуальные машины.
- Контейнеры позволяют платформе управлять развертыванием, мониторингом, маршрутизацией, конфигурацией и масштабированием приложений.
- В облачной среде несколько хостов запускают множество контейнеров, каждый из которых содержит всё необходимое для работы приложения.

---
### 3.2.2. Поддержка «постоянно меняющихся»
- Облачная платформа берёт на себя задачи устойчивости и управления изменениями, освобождая разработчиков от сложной ручной работы.
- Она автоматически распределяет экземпляры приложений по зонам доступности и поддерживает их работу при сбоях.
- Основной принцип — согласованность в конечном счёте: платформа постоянно сравнивает желаемое и фактическое состояние и устраняет расхождения.
- Этот процесс реализуется через API, хранилище состояний, компаратор и планировщик.
- Платформа сама должна быть устойчивой и самовосстанавливающейся, используя те же шаблоны, что и управляемые на ней приложения.
- Это выходит за рамки обычной автоматизации и обеспечивает поддержку постоянно меняющейся среды.

---
- Микросервисная автономность решает многие проблемы, но создаёт новые сложности распределённости.    
- Появляются задачи: обнаружение сервисов, динамическое обновление конфигураций, трассировка сложных запросов и повторная отправка при сбоях.
- Реализация всех этих шаблонов не должна ложиться на разработчика — их обеспечивает облачная платформа.
- Платформа поддерживает взаимодействие множества экземпляров и сервисов, обеспечивая надёжность и управляемость распределённой системы.
- Такие возможности критичны для корректной работы современных облачных приложений.

---
- Сервисы в распределённой системе должны находить друг друга для взаимодействия.
- Это может происходить через DNS и централизованную маршрутизацию или напрямую с балансировкой нагрузки.
- Ключевая задача — поддерживать актуальность маршрутов и информации об экземплярах сервисов.
- Платформа автоматизирует сбор и распространение данных об IP-адресах и точках входа новых или восстановленных экземпляров.
- Такая автоматизация делает взаимодействие между микросервисами надёжным и прозрачным.

---
- В распределённой архитектуре управление конфигурацией усложняется и требует автоматизации.
- Платформа обеспечивает централизованную службу конфигурации, с которой экземпляры получают нужные параметры.
- При изменении конфигурации платформа уведомляет все экземпляры и инициирует их обновление.
- Разработчику и оператору не нужно реализовывать этот механизм вручную — он встроен в платформу.
- Дополнительные сервисы, такие как распределённая трассировка и предохранители, повышают надёжность и упрощают эксплуатацию распределённых систем.

---
- Платформа для облачной среды определяет чёткую границу и контракт между собой и приложением через API и SLA.
- Это разделяет ответственность: одна команда управляет платформой, другая — разрабатывает и эксплуатирует приложения.
- Зоны ответственности не пересекаются, что повышает автономность и ускоряет развертывания.
- Каждая команда полностью отвечает за жизненный цикл своего продукта (платформы или приложения).
- Успех модели зависит от правильно спроектированного контракта и возможностей самой платформы — автоматизации, безопасности, поддержки микросервисов и мультиарендности.

---
- Платформа должна охватывать весь жизненный цикл разработки, а не только продакшен-развёртывания.
- Ключевой принцип — один артефакт, который проходит через все среды (dev, test, prod).
- Конвейеры автоматизируют сборку, тестирование и развёртывание артефакта.
- Среды разработки и тестирования различаются по полноте и структуре, но сохраняют общую форму. 
- Такой подход обеспечивает предсказуемость, повторяемость и поддержку непрерывной доставки.

---
- Среды разработки, тестирования и продакшена отличаются деталями, но должны иметь одинаковые базовые элементы и API.
- Паритет среды — ключевое условие для непрерывной доставки и предсказуемости развертывания.
- Обновления ОС и сервисов должны происходить синхронно во всех средах.
- Платформа должна обеспечивать единые контракты между приложением, конфигурацией и сервисами.
- Один и тот же артефакт должен использоваться на всех этапах жизненного цикла.
- Платформа должна охватывать весь жизненный цикл разработки, а не только продакшен.
- Автоматизация взаимодействий через единые API превращает процесс поставки ПО в стабильную и эффективную систему.

---
- Традиционные процессы безопасности, соответствия и контроля изменений тормозят развертывание.
- Основная проблема — множество ручных точек контроля, часто внедряемых слишком поздно.
- Amazon и другие лидеры встраивают элементы управления прямо в платформу.
- Встроенные механизмы гарантируют соответствие требованиям без ручных проверок.
- Это резко сокращает время между готовностью артефакта и его развертыванием — с дней до минут.
- Частые развертывания и быстрые циклы обратной связи становятся возможными.

---
- Контроль безопасности и соответствия достигается управлением всеми слоями контейнера: базовым образом, средой выполнения и артефактом.    
- Базовый образ должен быть минимальным для снижения площади атаки и включать только необходимые пакеты.
- Среда выполнения (например, JRE или Python) должна использовать только одобренные версии.
- Команда разработки отвечает только за приложение, а команда платформы — за базовые образы, среды выполнения и ядро ОС.
- Такой раздел ответственности обеспечивает встроенный контроль безопасности и соответствия на всех уровнях контейнера.

---
- Обновления в контейнерах выполняются через развёртывание новых экземпляров без изменения работающих и без простоя.
- Последовательное обновление применяется как к приложению, так и к компонентам платформы (ОС, среда выполнения).
- Команды приложения и платформы работают независимо: каждая обновляет свою часть контейнера по собственному графику.
- Такая автономность позволяет быстро применять патчи безопасности (CVE) без сложной координации.
- Платформа автоматически создаёт новые образы и заменяет старые экземпляры партиями, сохраняя доступность системы.

---
- Контроль изменений предотвращает негативное влияние новых развертываний на другие системы.
- Платформа решает эту задачу через изоляцию компонентов и поддержку мультиарендности.
- Контейнеры обеспечивают базовую изоляцию ресурсов, предотвращая взаимное влияние приложений.
- Платформа добавляет контроль доступа, мониторинг, маршрутизацию и планирование с учётом арендаторов.
- Мультиарендность позволяет изолировать изменения каждого приложения и повысить автономность команд.

# Глава 4 Событийно-ориентированные микросервисы: не только запрос/ответ
- Глава посвящена двум ключевым моделям взаимодействия микросервисов: запрос/ответ и событийно-ориентированной.
- Рассматриваются их применение, сходства и различия в контексте облачного ПО.
- Анализируется влияние этих моделей на архитектуру микросервисов и степень их связанности.
- Обсуждается риск превращения распределённой системы обратно в монолит при неправильной интеграции сервисов.
- Изучается использование CQRS как важного принципа построения взаимодействия.
- Цель — понять, как обе модели работают в облачной среде и как их сочетание повышает гибкость и устойчивость систем.

### 4.1. (Обычно) нас учат императивному программированию
- Императивное программирование формирует мышление в парадигме «запрос/ответ», где ожидается немедленный отклик.
- Эта модель хорошо работает в рамках одного процесса, но теряет эффективность в распределённых облачных средах.
- Несмотря на это, стиль «запрос/ответ» остаётся доминирующим на стороне сервера.
- В распределённых системах, как у Netflix, каскадные зависимости множества сервисов могут резко снижать общую доступность.
- Для компенсации применяются шаблоны вроде повторных запросов и кеширования, но они лишь частично решают проблему.
- Возникает необходимость рассмотреть альтернативные модели взаимодействия, выходящие за рамки традиционного подхода.

### 4.2. Повторное знакомство с событийно-ориентированными вычислениями
![[Pasted image 20251012232532.png]]
- Событийно-ориентированная система работает по принципу «выстрелил и забыл» — инициатор не ждёт ответа.
- Зависимости уменьшаются, так как источник события и обрабатывающий сервис не связаны напрямую.
- Событие и результат отделены друг от друга, что повышает гибкость и снижает связанность компонентов.
- В отличие от «запрос/ответ», событийный подход делает микросервисы более автономными и независимыми.
- Такие различия глубоко влияют на архитектуру и взаимодействие компонентов в облачной среде.